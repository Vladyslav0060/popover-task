<head>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"
    integrity="sha512-USPCA7jmJHlCNRSFwUFq3lAm9SaOjwG8TaB8riqx3i/dAJqhaYilVnaf2eVUH5zjq89BU6YguUuAno+jpRvUqA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"
    integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
</head>

<body>
  <div class="content-wrapper">
    <div class="tabs">
      <button class="tab active">Cash Flow</button>
      <button class="tab">NOI</button>
      <button class="tab">Dept Paydown</button>
      <button class="tab"><span>Equity: </span>Real Estate Net Worth</button>
      <button class="tab">Valuation</button>
    </div>
    <div class="content">
      <h2 class="title">Projected <span id="title_active_tab"></span></h2>
      <canvas id="newChart"></canvas>
    </div>
  </div>
</body>

<script>
  const titleActiveTabElement = document.getElementById("title_active_tab");
  const tabs = document.getElementsByClassName("tab");
  const changeActiveTabTitle = (tab_name) =>
    (titleActiveTabElement.innerHTML = tab_name);

  changeActiveTabTitle(
    document.getElementsByClassName("tab active")[0].innerHTML
  );
  Array.from(tabs).map((tab) =>
    tab.addEventListener("click", () => changeActiveTabTitle(tab.innerHTML))
  );

  let goal = 25000;
  let activeTab = 0;

  const allTabs = document.querySelectorAll(".tabs .tab");

  const tooltipLine = {
    id: "tooltipLine",
    beforeDraw: (chart) => {
      if (
        chart.tooltip?._active &&
        chart.tooltip?._active.length
        // && chart?.tooltip._active[0].index % 5 === 0
      ) {
        const activePoint = chart.tooltip._active[0];
        const activePoint1 = chart.tooltip._active[1];
        const ctx = chart.ctx;
        ctx.save();
        ctx.beginPath();
        ctx.setLineDash([]);
        ctx.moveTo(activePoint?.element.x, chart.chartArea.top);
        ctx.lineTo(activePoint?.element.x, chart.chartArea.bottom);
        ctx.lineWidth = 1;
        //creating gradient
        const gradient = chart.ctx.createLinearGradient(
          0,
          0,
          0,
          chart.chartArea.height
        );
        gradient.addColorStop(0.3, "rgba(11, 97, 164, 1)");
        gradient.addColorStop(0.7, "rgba(101, 162, 207, 1)");
        gradient.addColorStop(1, "rgba(101, 162, 207, 1)");
        ctx.strokeStyle = gradient;
        ctx.stroke();
        ctx.restore();
      }
    },
  };

  const labels = [
    "Today",
    "1 Year",
    "2 Years",
    "3 Years",
    "4 Years",
    "5 Years",
    "6 Years",
    "7 Years",
    "8 Years",
    "9 Years",
    "10 Years",
    "11 Years",
    "12 Years",
    "13 Years",
    "14 Years",
    "15 Years",
    "16 Years",
    "17 Years",
    "18 Years",
    "19 Years",
    "20 Years",
    "21 Years",
    "22 Years",
    "23 Years",
    "24 Years",
    "25 Years",
    "26 Years",
    "27 Years",
    "28 Years",
    "29 Years",
    "30 Years",
    "31 Years",
  ];

  const mockData = [
    {
      labels: labels,
      datasets: [
        {
          label: "Appreciation",
          backgroundColor: "rgb(176, 198, 254)",
          borderColor: "rgba(176, 198, 254, 1)",
          data: [
            2295, 3950, 4550, 7420, 7845, 10583, 11584, 11787, 12664, 13224,
            14955, 15942, 17176, 17387, 19788, 22038, 24199, 26605, 28322,
            29698, 31342, 31403, 35652, 37436, 38715, 44582, 44859, 47948,
            48235, 49069, 51000, 52500,
          ],
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(176, 198, 254, 1)",
          pointHoverBackgroundColor:
            "linear-gradient(135deg, #A1BBFF 0%, #C9DBE9 100%);",
        },
        {
          label: "Debt Paydown",
          backgroundColor: "rgba(246, 189, 22, 1)",
          borderColor: "rgba(246, 189, 22, 1)",
          data: null,
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(252, 223, 152, 1)",
        },
      ],
    },
    {
      labels: labels,
      datasets: [
        {
          type: "line",
          label: "Test NOI",
          data: [
            7220, 13401, 15120, 25103, 39379, 39945, 41036, 46679, 47720, 50974,
            51118, 51484, 86347, 88092, 93381, 97911, 100514, 107123, 113985,
            115020, 118484, 119372, 134681, 136214, 137366, 137851, 139330,
            140153, 142048, 142477, 146630, 151000,
          ],
          fill: false,
          backgroundColor: "rgb(176, 198, 254)",
          borderColor: "rgba(176, 198, 254, 1)",
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(176, 198, 254, 1)",
          pointHoverBackgroundColor:
            "linear-gradient(135deg, #A1BBFF 0%, #C9DBE9 100%);",
        },
      ],
    },
    {
      labels: labels,
      datasets: [
        {
          type: "line",
          label: "Test",
          data: [
            4887, 10772, 10833, 11337, 16868, 28110, 30592, 43626, 49843, 63658,
            64959, 67013, 67949, 82985, 84352, 84533, 90130, 95308, 96022,
            102284, 106758, 110422, 112119, 118320, 119493, 129784, 133783,
            136780, 143831, 147807, 149369, 150000,
          ],
          fill: false,
          backgroundColor: "rgb(176, 198, 254)",
          borderColor: "rgba(176, 198, 254, 1)",
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(176, 198, 254, 1)",
          pointHoverBackgroundColor:
            "linear-gradient(135deg, #A1BBFF 0%, #C9DBE9 100%);",
        },
      ],
    },
    {
      labels: labels,
      datasets: [
        {
          type: "line",
          label: "Test",
          data: [
            3622, 4401, 11453, 14379, 18150, 18526, 22911, 24079, 24140, 24384,
            28922, 32769, 37038, 39209, 46852, 53712, 57899, 61270, 71802,
            84034, 88652, 90587, 94954, 103740, 103987, 109957, 113051, 125870,
            126162, 137924, 147372, 149369,
          ],
          fill: false,
          backgroundColor: "rgb(176, 198, 254)",
          borderColor: "rgba(176, 198, 254, 1)",
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(176, 198, 254, 1)",
          pointHoverBackgroundColor:
            "linear-gradient(135deg, #A1BBFF 0%, #C9DBE9 100%);",
        },
      ],
    },
    {
      labels: labels,
      datasets: [
        {
          type: "line",
          label: "Test",
          data: [
            2055, 5443, 8376, 9622, 15345, 15478, 18227, 31118, 32017, 34416,
            35945, 36979, 39689, 43801, 50484, 53554, 53567, 68122, 68128,
            73732, 97604, 97813, 104460, 108829, 116874, 117790, 130785, 130796,
            134143, 135698, 142920, 149369,
          ],
          fill: false,
          backgroundColor: "rgb(176, 198, 254)",
          borderColor: "rgba(176, 198, 254, 1)",
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(176, 198, 254, 1)",
          pointHoverBackgroundColor:
            "linear-gradient(135deg, #A1BBFF 0%, #C9DBE9 100%);",
        },
      ],
    },
  ];

  const config = {
    type: "line",
    data: mockData[activeTab],
    options: {
      plugins: {
        legend: {
          display: false,
          labels: {
            usePointStyle: true,
            boxWidth: 8,
            boxHeight: 8,
            padding: 24,
            filter: function (legendItem, data) {
              let labelData =
                data.datasets[legendItem.datasetIndex]?.data?.length || null;
              return !!labelData ? true : false;
            },
            font: {
              size: 14,
              weight: 500,
              heigth: 17,
            },
          },
        },
      },
      interaction: {
        intersect: false,
        includeInvisible: false,
        mode: "index",
      },
      responsive: true,
      maintainAspectRatio: false,
      layout: {
        padding: {
          bottom: 30,
          left: 58,
          right: 45,
        },
      },
      elements: {
        line: {
          tension: 0.4,
        },
        point: {
          display: "none",
          pointRadius: (ctx) => (ctx.index % 5 === 0 ? 10 : 0),
          hoverRadius: (ctx) => (ctx.index % 5 === 0 ? 5 : 0),
          pointHoverRadius: (ctx) => (ctx.index % 5 === 0 ? 14.5 : 0),
          hoverBorderWidth: 2,
          hoverBorderColor: "#fff",
          hitRadius: 45,
          borderWidth: 3,
          borderColor: "#fff",
        },
      },
      scales: {
        yAxes: {
          position: "right",
          grid: {
            lineWidth: 0.5,
            borderDash: (ctx) => (ctx.borderDash = ctx.index === 0 ? [0] : [7]),
            drawTicks: false,
            color: "gray",
            drawBorder: false,
          },
          ticks: {
            maxTicksLimit: 7,
            padding: 10,
            color: "#898A8B",
            font: {
              size: 13,
              heigth: 12,
              weight: 400,
            },
            callback: (value) => {
              return numeral(value).format("$ 0,0.[00]");
            },
          },
        },
        xAxes: {
          grid: {
            drawTicks: true,
            drawOnChartArea: false,
            // tickWidth: (ctx) => (ctx.tickWidth = ctx.index % 5 === 0 ? 1 : 0),
          },
          ticks: {
            maxRotation: 0,
            autoSkip: false,
            color: "#898A8B",
            font: {
              size: 12,
              weight: 400,
            },
            callback: function (val, index) {
              return index % 5 === 0 ? this.getLabelForValue(val) : "";
            },
          },
        },
      },
    },
    plugins: [
      tooltipLine,
      {
        legend: {
          labels: {
            usePointStyle: true,
            boxWidth: 8,
            boxHeight: 8,
            padding: 24,
            font: {
              size: 24,
              weight: 500,
              heigth: 17,
            },
          },
        },
      },
    ],
  };

  let newChart = new Chart(document.getElementById("newChart"), config);

  const setActiveTab = (value) => {
    allTabs.forEach((tab) => tab.classList.remove("active"));
    activeTab = value;
    allTabs[value].classList.add("active");
    newChart.destroy();
    newChart.data = mockData[activeTab];
    newChart = new Chart(document.getElementById("newChart"), config);
  };

  allTabs.forEach((tab, index = 0) => {
    tab.addEventListener("click", (event) => setActiveTab(index));
  });
</script>

<style>
  .content-wrapper {
    display: flex;
    width: 1071px;
    height: 396px;
    gap: 5px;
  }

  .content-wrapper .tabs {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 190px;
  }

  .content-wrapper .tabs .tab {
    display: flex;
    flex-direction: column;
    flex: 1;
    max-height: 20%;
    justify-content: center;
    align-items: center;
    background: #ffffff;
    border: 1px solid #0b61a4;
    position: relative;
    height: 111px;
    cursor: pointer;
  }

  .content-wrapper .tabs .tab::after {
    content: "";
    display: none;
    width: 0;
    height: 0;
    border-top: 8px solid transparent;
    border-right: 10px solid #ffffff;
    border-bottom: 8px solid transparent;
    position: absolute;
    right: -1px;
    top: 50px;
  }

  .content-wrapper .tabs .tab.active {
    background: #0b61a4;
    color: rgba(255, 255, 255, 1);
  }

  .content-wrapper .tabs .tab.active::after {
    display: block;
    top: auto;
  }

  .content-wrapper .content {
    display: flex;
    flex-direction: column;
    width: 876px;
    border: 2px solid #0c60a4;
    justify-content: flex-end;
  }

  .content-wrapper .content h2.title {
    justify-self: center;
    margin: 0 auto;
    font-size: 18px;
    font-weight: 400;
    line-height: 22px;
    color: #555658;
  }
  .content-wrapper .content canvas {
    align-self: flex-end !important;
    width: 100% !important;
    height: 330px !important;
  }
</style>
