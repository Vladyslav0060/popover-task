<div class="element-papa">
  <div class="doughnut-chart1">
    <h2 class="doughnut-chart-title">Current Annual Return Breakdown</h2>
    <div class="canvas-wrap1">
      <canvas id="myChart" width="326px"></canvas>
      <p class="sum-text-center"></p>
    </div>
    <p class="toggle-count-value">
      Show Current Annual Return Breakdown in
      <span class="current-annual-type">Percents</span>
    </p>
  </div>
</div>
<style>
  .element-papa {
    max-width: 477px;
    max-height: 326px;
  }
  .canvas-wrap1 {
    margin-left: -30px;
    padding-top: 0px;
    position: relative;
    width: 82%;
  }
  .sum-text-center {
    font-family: Montserrat;
    font-style: normal;
    font-weight: normal;
    font-size: 18px;
    line-height: 22px;
    text-align: center;
    letter-spacing: 0.025em;
    color: #555658;
    position: absolute;
    min-width: 70px;
    left: 76px;
    top: 336px;
  }
  .doughnut-chart1 {
    width: 477px;
    height: 326px;
    position: relative;
  }
  .doughnut-chart-title {
    font-family: Montserrat;
    font-style: normal;
    font-weight: normal;
    font-size: 22px;
    line-height: 27px;
    color: #555658;
    position: absolute;
    top: 50px;
  }
  .toggle-count-value {
    font-family: Montserrat;
    font-style: normal;
    font-weight: 500;
    font-size: 14px;
    line-height: 17px;
    letter-spacing: 0.025em;
    text-decoration-line: underline;
    color: #0b61a4;
    cursor: pointer;
    position: absolute;
    bottom: -85px;
  }
  .doughnut-chart1 {
    width: 100%;
    height: 235px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    margin-top: -30px;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="text/javascript">
  {
    (function createChartDoughnut(id) {
      const appreciation = 5000;
      const debtPaydown = 6000;
      const cashflow = 7000;
      const depreciation = 3000;
      const DATA_COUNT = [appreciation, debtPaydown, cashflow, depreciation];
      let isCountPercent = false;
      const TOTAL_COUNT = (
        appreciation +
        debtPaydown +
        cashflow +
        depreciation
      ).toFixed(0);
      const replaceNumber = (text) => {
        const pattern = /\B(?=(\d{3})+(?!\d))/g;
        return text.toString().replace(pattern, ",");
      };
      const dataPars = (dataCount) => {
        const dataPercent = [];
        dataCount.map((item) => {
          dataPercent.push(Number(((item * 100) / 120000).toFixed(1)));
        });
        return dataPercent;
      };
      const reducer = (accumulator, currentValue) => accumulator + currentValue;
      const SUM_COUNT_PERCENT = dataPars(DATA_COUNT).reduce(reducer).toFixed();
      const sortedPercent = dataPars(DATA_COUNT).sort((a, b) => b - a);
      const BOT_RANGE = 50;
      const DISPERSION = 30;
      const maxVal = sortedPercent[0];
      const thicknessData = sortedPercent.map((item) => {
        let value;
        if (item === maxVal) {
          value = DISPERSION;
        } else {
          value = (item * DISPERSION) / maxVal;
        }
        return [BOT_RANGE, BOT_RANGE + value];
      });
      // Plugins
      const thickness = {
        id: "thickness",
        beforeDraw: (chart, options) => {
          let thickness = chart.options.plugins.thickness.thickness;

          chart.getDatasetMeta(0).data[0].innerRadius = 47.21;
          chart.getDatasetMeta(0).data[0].outerRadius = 82.83;
          chart.getDatasetMeta(0).data[1].innerRadius = 47.21;
          chart.getDatasetMeta(0).data[1].outerRadius = 77.59;
          chart.getDatasetMeta(0).data[2].innerRadius = 47.21;
          chart.getDatasetMeta(0).data[2].outerRadius = 72.59;
          chart.getDatasetMeta(0).data[3].innerRadius = 47.21;
          chart.getDatasetMeta(0).data[3].outerRadius = 66.1;
        },
      };
      const shadowPlugin = {
        beforeDraw: (chart, args, options) => {
          const { ctx } = chart;
          console.log(chart);
          ctx.shadowColor = "rgba(0, 0, 0, 0.12)";
          ctx.shadowBlur = 10;
          ctx.shadowOffsetX = 0;
          ctx.shadowOffsetY = -5;
        },
      };
      const CHART_COLORS = {
        blue: "#66A3D2",
        yellow: "#FFC373",
        purple: "#7272D5",
        green: "#7FDBB3",
      };
      const CHART_TITLE = [
        "Appreciation",
        "Debt Paydown",
        "Cash Flow",
        "Depreciation",
      ];

      const createLabelTitle = () => {
        const titleArr = [];
        if (isCountPercent) {
          dataPars(DATA_COUNT).map((item, index) => {
            titleArr.push(`${CHART_TITLE[index]} ${item} %    `);
          });
        } else {
          DATA_COUNT.map((item, index) => {
            titleArr.push(`${CHART_TITLE[index]} $ ${replaceNumber(item)}`);
          });
        }
        return titleArr;
      };

      const data = {
        labels: createLabelTitle(),
        datasets: [
          {
            data: dataPars(DATA_COUNT),
            backgroundColor: Object.values(CHART_COLORS),
          },
        ],
      };
      const config = {
        type: "doughnut",
        data: data,
        plugins: [thickness],
        options: {
          layout: {
            padding: {
              left: 0,
              right: 0,
            },
          },
          aspectRatio: 1,
          rotation: -20,
          borderRadius: 5,
          borderWidth: 0,
          responsive: true,
          plugins: {
            tooltip: {
              callbacks: {
                label: function (context) {
                  return " " + context.label;
                },
              },
            },
            legend: {
              onClick() {},
              position: "right",
              align: "center",
              maxWidth: 158,
              labels: {
                boxWidth: 15,
                boxHeight: 15,
              },
            },
            thickness: {
              thickness: thicknessData,
            },
          },
        },
      };

      const canvasWrap = document.querySelector(".canvas-wrap1");
      const chart = document.createElement("canvas");
      canvasWrap.appendChild(chart);
      const chartId = `myChart${id}`;
      chart.id = chartId;
      const ctx = document.getElementById(chartId);

      const myChart = new Chart(ctx, config);

      const sumTextCenter = document.querySelector(".sum-text-center");
      sumTextCenter.innerText = `${
        isCountPercent
          ? SUM_COUNT_PERCENT + " %"
          : "$" + replaceNumber(TOTAL_COUNT)
      }`;

      const elAnualType = document.querySelector(".current-annual-type");
      const toggleCountType = document.querySelector(".toggle-count-value");
      toggleCountType.addEventListener("click", () => {
        isCountPercent = !isCountPercent;
        myChart.data.labels = createLabelTitle();
        myChart.update();
        sumTextCenter.innerText = `${
          isCountPercent
            ? SUM_COUNT_PERCENT + " %"
            : "$" + replaceNumber(TOTAL_COUNT)
        }`;
        elAnualType.innerText = isCountPercent ? "Dollars" : "Percents";
      });
    })();
  }
</script>
