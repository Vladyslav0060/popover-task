<head>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&family=Poppins:wght@400;500;600&display=swap"
    rel="stylesheet"
  />

  <link
    rel="stylesheet"
    href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css"
  />
  <link rel="stylesheet" href="/resources/demos/style.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<div>
  <div id="progress0">
    <div class="goal-progress0">
      <span class="goal-progress__current-sum0"></span>
      <span class="goal-progress__goal-sum0"></span>
    </div>
    <div id="ProgressBg0">
      <div id="ProgressBar0"></div>
      <div id="ProgressBar1"></div>
    </div>
    <div class="description-container">
      <p class="description-bar0" />
      <div class="description-container__popover" data-toggle="popover">
        <img
          src="http://s3.amazonaws.com/appforest_uf/f1663766856939x122820179078912510/Icon_I%20%281%29.svg"
          alt=""
          id="tt"
        />
      </div>
    </div>
  </div>
</div>

<style>
  #progress0 {
    max-width: 477px;
  }

  #ProgressBg0 {
    display: flex;
    height: 8px;
    background: rgba(137, 138, 139, 0.3);
    border-radius: 30px;
    position: relative;
  }

  #ProgressBg0:after {
    content: "";
    display: block;
    width: 3px;
    height: 16px;
    border-radius: 20px;
    background-color: #898a8b;
    position: absolute;
    top: -4px;
    right: 82px;
  }

  #ProgressBar0 {
    background: linear-gradient(180deg, #81deb5 0%, #65cea1 100%);
    border: 0.5px solid #ffffff;
    box-sizing: border-box;
    border-radius: 30px;
    height: 9px;
    width: 1%;
    text-align: center;
    line-height: 30px;
    color: white;
    position: relative;
  }

  #ProgressBar0:after {
    content: "";
    display: block;
    width: 1px;
    height: 5px;
    background: #ffffff;
    border-radius: 20px;
    position: absolute;
    top: 1px;
    right: 16px;
    z-index: 1000;
  }

  #ProgressBar1 {
    background: linear-gradient(180deg, #0b61a4 0%, #3c8fd0 100%);
    border: 0.5px solid #ffffff;
    box-sizing: border-box;
    border-radius: 30px;
    height: 9px;
    /* width: calc(1% + 5px); */
    text-align: center;
    line-height: 30px;
    color: white;
    position: relative;
    /* margin-left: -5px; */
    /* margin-right: 50px; */
  }

  /* #ProgressBar1::before {
    content: "";
    display: block;
    position: relative;
    right: 5px;
    top: 0;
    width: 15px;
    border-radius: 30px;
    height: 7px;
    border-left: 0.5px solid #ffffff;
    background: linear-gradient(180deg, #0b61a4 0%, #3c8fd0 100%);
  } */

  .goal-progress0 {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 3px;
    padding: 0 40px;
  }

  .goal-progress0 .goal-progress__current-sum0,
  .goal-progress__goal-sum0 {
    font-family: Montserrat;
    font-style: normal;
    font-weight: normal;
    font-size: 18px;
    line-height: 22px;
    letter-spacing: 0.025em;
    color: #08090d;
  }

  .description-container {
    display: flex;
    justify-content: start;
    align-items: center;
    gap: 6px;
  }

  .description-container .popover .arrow {
    display: none;
  }
  .description-container .popover .close {
    width: 30px;
    height: 30px;
    background-color: blue;
  }
  .description-container__popover {
    width: 16px;
    padding-top: 5px;
  }

  .description-bar0 {
    font-family: Montserrat;
    font-style: normal;
    font-weight: 500;
    font-size: 16px;
    line-height: 20px;
    color: #898a8b;
    margin: 5px 0 0;
  }

  [role="tooltip"] {
    border: 1px solid rgba(11, 97, 164, 1) !important;
    box-shadow: none;
    border-radius: 5px;
    max-width: 400px;
  }

  [role="tooltip"] .ui-tooltip-content {
    padding: 15px 35px 15px 15px;
    font-family: "Montserrat", sans-serif;
    font-style: normal;
    font-weight: 400;
    font-size: 12px;
    line-height: 15px;
    letter-spacing: 0.025em;

    color: #3c3e40;
  }
  [role="tooltip"] .tooltip-container .close {
    display: flex;
    width: 16px;
    align-items: center;
    justify-content: center;
    height: 16px;
    position: absolute;
    top: 6px;
    right: 13px;
    text-align: center;
    color: white;
    border-radius: 50px;
    background: #0b61a4;
    border: none;
    line-height: 16px;
    font-size: 10px;
    cursor: pointer;
  }

  [role="tooltip"] .tooltip-container .close span {
    position: relative;
    left: 0.5px;
    font-size: 20px;
  }
</style>

<script>
  {
    const id = "#tt";
    const $elem = $(id);

    $elem.on("mouseenter", function (e) {
      e.stopImmediatePropagation();
      $(this).attr(
        "src",
        "http://s3.amazonaws.com/appforest_uf/f1628765173777x457896309616959500/Property%20Info.svg"
      );
      $elem.tooltip("open");
    });

    $elem.tooltip({
      items: id,
      content: `<div class="tooltip-container">
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Libero ex expedita quos, error laudantium beatae.
        <div class="close">
          <span>Ã—</span>
        </div>
      </div>`,
    });

    $elem.on("click", function (e) {
      $elem.tooltip("open");
    });

    $elem.on("mouseleave", function (e) {
      e.stopImmediatePropagation();
      $(this).attr(
        "src",
        "http://s3.amazonaws.com/appforest_uf/f1663766856939x122820179078912510/Icon_I%20%281%29.svg"
      );
    });

    $(document).mouseup(function (e) {
      const container = $(".ui-tooltip");
      if (
        !container.is(e.target) &&
        container.has(e.target).length !== 0 &&
        e.target.parentElement.className === "close"
      ) {
        $elem.tooltip("close");
      }
    });

    const replaceNumber = (text) => {
      const pattern = /\B(?=(\d{3})+(?!\d))/g;
      return text.toString().replace(pattern, ",");
    };

    const CURRENT_SUM = 500000;
    const GOAL_SUM = 1000000;
    const BLUE_SUM = -100000;
    const DESCRIPTION_BAR = "RE Valuation Goal";
    const ElCurrentSum = document.querySelector(".goal-progress__current-sum0");
    ElCurrentSum.textContent = "$ " + replaceNumber(CURRENT_SUM);
    const ElGoalSum = document.querySelector(".goal-progress__goal-sum0");
    ElGoalSum.textContent = "$ " + replaceNumber(GOAL_SUM);
    const ElDescriptionBar = document.querySelector(".description-bar0");
    ElDescriptionBar.textContent = DESCRIPTION_BAR;

    let i = 0;
    const move = () => {
      let goalSumPercent = ((CURRENT_SUM * 83) / GOAL_SUM).toFixed();
      let goalSumPercent1 = ((Math.abs(BLUE_SUM) * 83) / GOAL_SUM).toFixed();
      if (i === 0) {
        i = 1;
        const progressBar = document.getElementById("ProgressBar0");
        const progressBar1 = document.getElementById("ProgressBar1");
        progressBar.style.marginRight = -1 + "%";
        let width = 0;
        let width1 = 0;
        if (goalSumPercent >= 100) goalSumPercent = 100;
        if (BLUE_SUM < 100 && BLUE_SUM >= 0)
          progressBar1.style.display = "none";
        if (BLUE_SUM < 0) {
          progressBar1.style.background = "red";
          progressBar1.style.transform = "translate(-90%)";
        }
        const id = setInterval(() => {
          console.log(goalSumPercent);
          if (width >= goalSumPercent && width1 >= goalSumPercent1) {
            progressBar1.style.width = width1 + 1 + "%";
            clearInterval(id);
            i = 0;
          } else if (width <= goalSumPercent) {
            width++;
            progressBar.style.width = width + "%";
          } else if (width1 <= goalSumPercent1 && width + width1 <= 100) {
            width1++;
            progressBar1.style.width = width1 + "%";
          }
        }, 1);
      }
    };
    move();
  }
</script>
