<head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <!-- <div class="content_l2"> -->
  <!-- <div class="controls">
      <div class="chart-data-btn active" data-chart-index="0" data-chart-name="accumulated">
        <p id="control-title-accumulated" class="chart-data-btn__title">$ 406,865</p>
        <p class="chart-data-btn__desc">Projected <br>Accumulated Wealth</p>
      </div>
      <div class="chart-data-btn" data-chart-index="1" data-chart-name="cash-flow">
        <p id="control-title-cash-flow" class="chart-data-btn__title">$ 406,865</p>
        <p class="chart-data-btn__desc">Projected
          Cash Flow</p>
      </div>
      <div class="chart-data-btn" data-chart-index="2" data-chart-name="">
        <p id="control-title-projected-equity" class="chart-data-btn__title">$ 406,865</p>
        <p class="chart-data-btn__desc">Projected Equity</p>
      </div>
    </div> -->

  <!-- <div>
      <h2 class="title_l12">Projected Property Value</h2>
      <h3 class="sub-title_l12">30 Year Projection</h3>
      <ul class="list-points"></ul>
      <div class="chart-wrap_l12">
        <canvas id="myChartL12"></canvas>
        <div class="legend"></div>
      </div>
    </div>
  </div> -->

  <div class="content-wrapper">
    <div class="tabs">
      <button class="tab active">Cashflow</button>
      <button class="tab">NOI</button>
      <button class="tab">Dept Paydown</button>
      <button class="tab"><span>Equity:</span>Realestate Net Worth</button>
      <button class="tab">Valuation</button>
    </div>
    <div class="content">
      <canvas id="newChart"></canvas>
    </div>
  </div>
</body>

<script>
  let activeTab = 0;

  const allTabs = document.querySelectorAll(".tabs .tab");

  const labels = [
    "Today",
    "1 Year",
    "2 Years",
    "3 Years",
    "4 Years",
    "5 Years",
    "6 Years",
    "7 Years",
    "8 Years",
    "9 Years",
    "10 Years",
    "11 Years",
    "12 Years",
    "13 Years",
    "14 Years",
    "15 Years",
    "16 Years",
    "17 Years",
    "18 Years",
    "19 Years",
    "20 Years",
    "21 Years",
    "22 Years",
    "23 Years",
    "24 Years",
    "25 Years",
    "26 Years",
    "27 Years",
    "28 Years",
    "29 Years",
    "30 Years",
  ];

  const data = {
    labels: labels,
    datasets: [
      {
        label: "My First dataset",
        backgroundColor: "rgba(176, 198, 254, 1)",
        borderColor: "rgba(101, 162, 207, 1)",
        borderWidth: 3,
        data: [
          2295, 3950, 4550, 7420, 7845, 10583, 11584, 11787, 12664, 13224,
          14955, 15942, 17176, 17387, 19788, 22038, 24199, 26605, 28322, 29698,
          31342, 31403, 35652, 37436, 38715, 44582, 44859, 47948, 48235, 49069,
          51000,
        ],
      },
      {
        type: "line",
        label: "Goal",
        data: new Array(31).fill(30000),
        fill: false,
        borderColor: "red",
        pointRadius: 0,
      },
    ],
  };

  const config = {
    type: "line",
    data: data,
    options: {
      interaction: {
        intersect: false,
        mode: "index",
      },
      responsive: true,
      maintainAspectRatio: false,
      layout: {
        padding: {
          bottom: 30,
          left: 25,
          right: 45,
        },
      },
      elements: {
        line: {
          tension: 0.4,
        },
        point: {
          radius: (ctx) => (ctx.index % 5 === 0 ? 6 : 0),
        },
      },
      scales: {
        yAxes: {
          position: "right",
          grid: {
            lineWidth: 0.5,
            borderDash: (ctx) => (ctx.borderDash = ctx.index === 0 ? [0] : [7]),
            drawTicks: false,
            color: "gray",
            drawBorder: false,
          },
          ticks: {
            padding: 10,
          },
        },
        xAxes: {
          grid: {
            drawTicks: true,
            drawOnChartArea: false,
            tickWidth: (ctx) => (ctx.tickWidth = ctx.index % 5 === 0 ? 1 : 0),
          },
          ticks: {
            maxRotation: 0,
            autoSkip: false,
            color: "#898A8B",
            callback: function (val, index) {
              return index % 5 === 0 ? this.getLabelForValue(val) : "";
            },
          },
        },
      },
      plugins: {
        tooltip: {
          enabled: false,
        },
        legend: {
          labels: {
            usePointStyle: true,
            boxWidth: 8,
            boxHeight: 8,
            padding: 15,
          },
        },
      },
    },
  };

  const newChart = new Chart(document.getElementById("newChart"), config);

  const setActiveTab = (value) => {
    allTabs.forEach((tab) => tab.classList.remove("active"));
    activeTab = value;
    allTabs[value].classList.add("active");
  };

  allTabs.forEach((tab, index = 0) => {
    tab.addEventListener("click", (event) => setActiveTab(index));
  });
</script>

<style>
  .content-wrapper {
    display: flex;
    width: 1071px;
    height: 396px;
    gap: 5px;
  }

  .content-wrapper .tabs {
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 190px;
  }

  .content-wrapper .tabs .tab {
    display: flex;
    flex-direction: column;
    flex: 1;
    max-height: 20%;
    justify-content: center;
    align-items: center;
    border: 3px solid grey;
    border-radius: 5px;
  }

  .content-wrapper .tabs .tab.active {
    background: rgba(11, 97, 164, 1);
    color: rgba(255, 255, 255, 1);
  }

  .content-wrapper .content {
    display: flex;
    width: 876px;
    border: 6px solid #898a8b;
    border-radius: 20px;
  }

  .content-wrapper .content canvas {
    align-self: flex-end !important;
    width: 100% !important;
    height: 330px !important;
  }
</style>

<style>
  .tooltip-cash-flow-content {
    width: 70px;
    min-height: 130px;
    background-color: yellowgreen;
    border-radius: 2px;
    z-index: 9999999;
    position: absolute;
    top: -50px;
    left: 15px;
  }

  .tooltip-cash-flow-content .tooltip-cash-flow-content__text {
    text-align: center;
    padding: 5px;
    min-height: 30px;

    font-family: Montserrat;
    font-style: normal;
    font-weight: 500;
    font-size: 10px;
    line-height: 13px;
    color: #ffffff;
  }

  .tooltip-cash-flow-content .tooltip-cash-flow-content__text p {
    font-size: 12px;
    margin-bottom: 5px;
  }

  .tooltip-cash-flow-content__text_top {
    background-color: #7fdbb3;
  }

  .tooltip-cash-flow-content__text_middle {
    background-color: #65a2cf;
  }

  .tooltip-cash-flow-content__text_bottom {
    background-color: #f6bd16;
  }

  .content_l2 {
    display: flex;
    justify-content: center;
  }

  #myChartL12 {
    max-width: 778px;
    max-height: 300px;
    max-height: 250px;
  }

  .chart-wrap_l12 {
    min-width: 778px;
  }

  .legend {
    display: flex;
    margin-top: -10px;
    margin-left: -3px;
    width: 92%;
  }

  .legend .legend__label {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 27px;
    background-color: #94a0ac;
    border: 1px solid #fff;
    cursor: pointer;
    z-index: 100000;

    font-family: Montserrat;
    font-style: normal;
    font-weight: 500;
    font-size: 11px;
    line-height: 13px;
    color: #ffffff;
  }

  .legend__label.active {
    background-color: #ff5c5c;
  }

  .title_l12 {
    font-family: Montserrat;
    font-style: normal;
    font-weight: normal;
    font-size: 22px;
    line-height: 27px;
    color: #555658;
    text-align: center;
    margin: 0 0 10px 0;
  }

  .sub-title_l12 {
    font-family: Montserrat;
    font-style: normal;
    font-weight: normal;
    font-size: 16px;
    line-height: 20px;
    color: #555658;
    text-align: center;
    margin: 0 0 10px 0;
  }

  .sub-title_l12.hidden {
    display: none;
  }

  .list-points {
    display: none;
    justify-content: center;
    list-style: none;
    padding: 0;
    margin: 0 0 10px 0;
  }

  .list-points li {
    font-family: Montserrat;
    font-style: normal;
    font-weight: 500;
    font-size: 16px;
    line-height: 20px;
    letter-spacing: 0.025em;
    color: #08090d;
    margin-right: 54px;
  }

  .list-points li:last-child {
    margin-right: 0;
  }

  .controls {
    width: 190px;
    height: 331px;
    box-sizing: border-box;
    padding-right: 15px;
  }

  .controls .chart-data-btn {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 0 4px;
    position: relative;
    border-top: 1px solid #0b61a4;
    border-right: 1px solid #0b61a4;
    border-left: 1px solid #0b61a4;
    height: 111px;
    cursor: pointer;
  }

  .controls .chart-data-btn.active {
    background-color: #0b61a4;
  }

  .controls .chart-data-btn.active:after {
    content: "";
    display: none;
    width: 0;
    height: 0;
    border-top: 8px solid transparent;
    border-right: 10px solid #ffffff;
    border-bottom: 8px solid transparent;
    position: absolute;
    right: -1px;
    top: 50px;
  }

  .controls .chart-data-btn.active .chart-data-btn__title,
  .controls .chart-data-btn.active .chart-data-btn__desc {
    color: #ffffff;
  }

  .controls .chart-data-btn:last-child {
    border-bottom: 1px solid #0b61a4;
  }

  .controls .chart-data-btn:after {
    content: "";
    display: none;
    width: 0;
    height: 0;
    border-top: 8px solid transparent;
    border-right: 10px solid #ffffff;
    border-bottom: 8px solid transparent;
    position: absolute;
    right: -1px;
    top: 50px;
  }

  .controls .chart-data-btn:hover {
    background-color: #0b61a4;
    border-bottom: 1px solid #0b61a4;
  }

  /*.controls .chart-data-btn:hover:after {*/
  /*    display: block;*/
  /*}*/

  .controls .chart-data-btn:hover .chart-data-btn__title,
  .controls .chart-data-btn:hover .chart-data-btn__desc {
    color: #ffffff;
  }

  .chart-data-btn__title {
    font-family: Montserrat;
    font-style: normal;
    font-weight: 500;
    font-size: 24px;
    line-height: 29px;
    letter-spacing: 0.025em;
    text-align: center;
    color: #0b61a4;
    margin: 0 0 5px 0;
  }

  .chart-data-btn__desc {
    font-family: Montserrat;
    font-style: normal;
    font-weight: 500;
    font-size: 16px;
    line-height: 20px;
    letter-spacing: 0.025em;
    text-align: center;
    color: #0b61a4;
    margin: 0;
  }
</style>

<!-- <script>
  {
    let customTooltip = (context) => {
      let tooltipEl = document.getElementById("custom-tooltip-cash-flow");
      // Create element on first render
      if (!tooltipEl) {
        tooltipEl = document.createElement("div");
        tooltipEl.id = "custom-tooltip-cash-flow";
        tooltipEl.innerHTML = '<div class="tooltip-cash-flow-content"></div>';
        document.body.appendChild(tooltipEl);
      }
      // Hide if no tooltip
      let tooltipModel = context.tooltip;
      if (tooltipModel.opacity === 0) {
        tooltipEl.style.opacity = 0;
        return;
      }

      // Set caret Position
      tooltipEl.classList.remove("above", "below", "no-transform");
      if (tooltipModel.yAlign) {
        tooltipEl.classList.add(tooltipModel.yAlign);
      } else {
        tooltipEl.classList.add("no-transform");
      }

      // Set Text
      if (tooltipModel.body) {
        tooltipEl.insertAdjacentHTML(
          "beforeend",
          `<div class="tooltip-cash-flow-content">
                  <div class="tooltip-cash-flow-content__text tooltip-cash-flow-content__text_top"> <p>INCOME</p> ${
                    income[context.tooltip.title[0] - 1]
                  } </div>
                  <div class="tooltip-cash-flow-content__text tooltip-cash-flow-content__text_middle"><p>CASH FLOW</p> ${
                    cashFlow[context.tooltip.title[0] - 1]
                  } </div>
                  <div class="tooltip-cash-flow-content__text tooltip-cash-flow-content__text_bottom"><p>EXPENSES</p> ${
                    expenses[context.tooltip.title[0] - 1]
                  } </div>
                </div>`
        );
      }

      let position = context.chart.canvas.getBoundingClientRect();
      let bodyFont = Chart.helpers.toFont(tooltipModel.options.bodyFont);

      // Display, position, and set styles for font
      tooltipEl.style.opacity = 1;
      tooltipEl.style.position = "absolute";
      tooltipEl.style.left =
        position.left + window.pageXOffset + tooltipModel.caretX + "px";
      tooltipEl.style.top =
        position.top + window.pageYOffset + tooltipModel.caretY + "px";
      tooltipEl.style.font = bodyFont.string;
      tooltipEl.style.padding =
        tooltipModel.padding + "px " + tooltipModel.padding + "px";
      tooltipEl.style.pointerEvents = "none";
    };

    const parsValue = (value) => {
      const pattern = /\B(?=(\d{3})+(?!\d))/g;
      return "$ " + value.toFixed().toString().replace(pattern, ",");
    };

    const COUNT_YEARS = 30;
    const cashFlow = [
      2295, 3950, 4550, 7420, 7845, 10583, 11584, 11787, 12664, 13224, 14955,
      15942, 17176, 17387, 19788, 22038, 24199, 26605, 28322, 29698, 31342,
      31403, 35652, 37436, 38715, 44582, 44859, 47948, 48235, 49069,
    ];
    const appreciation = [
      4332, 9179, 14838, 16193, 16248, 16998, 19873, 20290, 20400, 22003, 23726,
      24302, 24953, 25802, 29483, 29783, 30716, 34271, 36627, 36878, 37159,
      38404, 39329, 42952, 43661, 45302, 47902, 48230, 49125, 49348,
    ];
    const debtPaydown = [
      2414, 3640, 3935, 4069, 4509, 5567, 11163, 11715, 12076, 12485, 14203,
      14804, 15543, 17107, 18938, 19572, 19828, 20650, 20817, 21454, 22282,
      26320, 26457, 27371, 33638, 34753, 35842, 36453, 41329, 44746,
    ];
    console.log("debtPaydown", debtPaydown);
    const reducerData = (date) => {
      const arr = [];
      date.reduce((previousValue, currentValue) => {
        arr.push(previousValue);
        return previousValue + currentValue;
      }, date[0]);
      return arr;
    };
    console.log("reducerData", reducerData(debtPaydown));

    const loanBalance = [
      3880, 5239, 5246, 6387, 6640, 8037, 8139, 11030, 12107, 13777, 14587,
      15636, 18400, 19772, 19850, 22944, 27804, 28769, 29879, 31666, 35439,
      35943, 36660, 37604, 39967, 41683, 42198, 42281, 43505, 46583,
    ];
    const expenses = [
      2351, 3304, 4858, 5111, 5138, 5531, 5555, 6868, 7739, 8182, 8696, 10753,
      16327, 17543, 18350, 18384, 22554, 22847, 24699, 26909, 28183, 33052,
      35308, 35367, 35702, 39026, 46619, 48330, 48782, 49572,
    ];
    const income = [
      1230, 1967, 3898, 5670, 9787, 10851, 13474, 15990, 16561, 21797, 24080,
      27491, 31551, 31710, 31990, 32363, 33838, 34095, 34355, 34509, 35271,
      38404, 38746, 41603, 43092, 45377, 45965, 47314, 48594, 49174,
    ];

    const elSubTitle = document.querySelector(".sub-title_l12");
    const elAccumulatedTitle = document.querySelector(
      "#control-title-accumulated"
    );
    const elCashFlowTitle = document.querySelector("#control-title-cash-flow");
    const elProjectedEquityTitle = document.querySelector(
      "#control-title-projected-equity"
    );

    const labels = () => {
      let arr = [];
      for (let i = 1; i <= COUNT_YEARS; i++) {
        arr.push(i);
      }
      return arr;
    };

    const currentDataChart = (data) => {
      const chartDates = {
        cashFlow,
        appreciation,
        debtPaydown: reducerData(debtPaydown),
        loanBalance,
      };
      if (typeof data !== "string") {
        throw new Error("arg not a sting");
      }
      return chartDates[data];
    };

    const appreciationDataChart = {
      labels: labels(),
      datasets: [
        {
          pointRadius: 0,
          label: "Cash Flow",
          data: currentDataChart("cashFlow"),
          borderColor: "rgb(75, 192, 192)",
          backgroundColor: "#F6BD16",
          tension: 1,
          fill: true,
        },
        {
          pointRadius: 0,
          label: "Appreciation",
          data: currentDataChart("appreciation"),
          borderColor: "rgb(75, 192, 192)",
          backgroundColor: "#65A2CF",
          tension: 1,
          fill: true,
        },
        {
          pointRadius: 0,
          label: "Debt Paydown",
          data: currentDataChart("debtPaydown"),
          borderColor: "rgb(75, 192, 192)",
          backgroundColor: "#7FDBB3",
          tension: 1,
          fill: true,
        },
      ],
    };
    const cashFlowDataChart = {
      labels: labels(),
      datasets: [
        {
          label: "Cash Flow",
          data: cashFlow,
          backgroundColor: "rgba(127, 219, 179, 1)",
        },
      ],
    };
    const appreciationDataLoanBalance = {
      labels: labels(),
      datasets: [
        {
          pointRadius: 0,
          label: "Principal",
          data: currentDataChart("loanBalance"),
          borderColor: "rgb(75, 192, 192)",
          backgroundColor: "#7373D8",
          tension: 1,
          fill: true,
        },
        {
          pointRadius: 0,
          label: "Debt Paydown",
          data: currentDataChart("cashFlow"),
          borderColor: "rgb(75, 192, 192)",
          backgroundColor: "#F6BD16",
          tension: 1,
          fill: true,
        },
        {
          pointRadius: 0,
          label: "Appreciation",
          data: currentDataChart("appreciation"),
          borderColor: "rgb(75, 192, 192)",
          backgroundColor: "#65A2CF",
          tension: 1,
          fill: true,
        },
      ],
    };

    //plugins
    //myEventCatcher
    const myEventCatcher = {
      id: "myEventCatcher",
      beforeEvent(chart, args, pluginOptions) {
        const event = args.event;
        if (event.type === "mouseout") {
          setDefaultValueInHtml();
        }
      },
    };
    // annotationLine
    const annotationLine = {
      id: "annotationLine",
      afterEvent: (chart, args, options) => {
        const tooltipValueX =
          chart.$context.chart._sortedMetasets[0].data[
            globalDataXMousemoveEvent
          ].x;
        const ctx = chart.ctx;
        ctx.save();
        ctx.beginPath();
        ctx.moveTo(tooltipValueX, chart.chartArea.top);
        ctx.lineTo(tooltipValueX, chart.chartArea.bottom);
        ctx.setLineDash([5, 3]); /*dashes are 5px and spaces are 3px*/
        ctx.lineWidth = 1;
        ctx.strokeStyle = "#E1E1E1";
        ctx.stroke();
        ctx.restore();
      },
    };
    let globalDataXMousemoveEvent = 0;
    const configAppreciation = {
      type: "line",
      data: appreciationDataChart,
      options: {
        onHover: (e) => {
          const canvasPosition = Chart.helpers.getRelativePosition(
            e,
            myChartL12
          );
          // Substitute the appropriate scale IDs
          const dataX = myChartL12.scales.xAxes.getValueForPixel(
            canvasPosition.x
          );
          globalDataXMousemoveEvent = dataX;
          showPointsLines(dataX, e.chart);
          setLineChartPoints(dataX);
          setCurrentSumControls(dataX);
        },
        scales: {
          yAxes: {
            stacked: true,
            position: "right",
            ticks: {
              count: 4,
              maxTicksLimit: 4,
              callback: function (value, index, values) {
                const pattern = /\B(?=(\d{3})+(?!\d))/g;
                return "$ " + value.toFixed().toString().replace(pattern, ",");
              },
              stepSize: 4,
            },
          },
          xAxes: {
            grid: {
              display: false,
            },
            ticks: {
              display: false,
              color: "#FFFFFF",
              callback: function (tickValue, index, ticks) {
                return index + 1;
              },
            },
          },
        },
        markers: {
          size: [4, 7],
        },
        plugins: {
          tooltip: {
            enabled: false,
          },
          legend: {
            labels: {
              usePointStyle: true,
              boxWidth: 8,
              boxHeight: 8,
            },
          },
        },
      },
      plugins: [myEventCatcher, annotationLine],
    };
    const configCashFlow = {
      type: "bar",
      data: cashFlowDataChart,
      options: {
        onHover: (e, elements) => {
          const canvasPosition = Chart.helpers.getRelativePosition(
            e,
            myChartL12
          );
          // Substitute the appropriate scale IDs
          const dataX = myChartL12.scales.xAxes.getValueForPixel(
            canvasPosition.x
          );
          showPointsLines(dataX);
          setCurrentSumControls(dataX);
          // hoverOpacityChartCashFlow(elements);
        },
        scales: {
          yAxes: {
            borderColor: "#000",
            gridLines: {
              show: false,
              color: "#ffffff",
            },
            stacked: true,
            position: "right",
            ticks: {
              count: 4,
              maxTicksLimit: 4,
              callback: function (value, index, values) {
                const pattern = /\B(?=(\d{3})+(?!\d))/g;
                return "$ " + value.toFixed().toString().replace(pattern, ",");
              },
              stepSize: 4,
            },
          },
          xAxes: {
            grid: {
              display: false,
            },
            ticks: {
              display: false,
              color: "#FFFFFF",
              callback: function (tickValue, index, ticks) {
                return index + 1;
              },
            },
          },
        },
        plugins: {
          tooltip: {
            enabled: false,
            external: function (context) {
              customTooltip(context);
            },
          },
          legend: {
            labels: {
              usePointStyle: true,
              boxWidth: 8,
              boxHeight: 8,
            },
          },
        },
      },
      plugins: [
        {
          id: "myEventCatcher",
          beforeEvent(chart, args, pluginOptions) {
            const event = args.event;
            if (event.type === "mouseout") {
              setDefaultValueInHtml();
            }
          },
        },
      ],
    };
    const configLoanBalance = {
      type: "line",
      data: appreciationDataLoanBalance,
      options: {
        onHover: (e) => {
          const canvasPosition = Chart.helpers.getRelativePosition(
            e,
            myChartL12
          );
          // Substitute the appropriate scale IDs
          const dataX = myChartL12.scales.xAxes.getValueForPixel(
            canvasPosition.x
          );
          globalDataXMousemoveEvent = dataX;
          setLineChartPoints(dataX);
          showPointsLines(dataX);
          setCurrentSumControls(dataX);
        },
        scales: {
          yAxes: {
            stacked: true,
            position: "right",
            ticks: {
              count: 4,
              maxTicksLimit: 4,
              callback: function (value, index, values) {
                const pattern = /\B(?=(\d{3})+(?!\d))/g;
                return "$ " + value.toFixed().toString().replace(pattern, ",");
              },
              stepSize: 4,
            },
          },
          xAxes: {
            grid: {
              display: false,
            },
            ticks: {
              display: false,
              color: "#FFFFFF",
              callback: function (tickValue, index, ticks) {
                return index + 1;
              },
            },
          },
        },
        markers: {
          size: [4, 7],
        },
        plugins: {
          tooltip: {
            enabled: false,
          },
          legend: {
            labels: {
              usePointStyle: true,
              boxWidth: 8,
              boxHeight: 8,
            },
          },
        },
      },
      plugins: [myEventCatcher, annotationLine],
    };
    let myChartL12 = new Chart(
      document.getElementById("myChartL12"),
      configAppreciation
    );

    // Function runs on chart type select update
    const showCashFlowData = () => {
      myChartL12.destroy();
      myChartL12 = new Chart(
        document.getElementById("myChartL12"),
        configCashFlow
      );
    };
    const showAppreciationData = () => {
      myChartL12.destroy();
      myChartL12 = new Chart(
        document.getElementById("myChartL12"),
        configAppreciation
      );
    };
    const showLoanBalance = () => {
      myChartL12.destroy();
      myChartL12 = new Chart(
        document.getElementById("myChartL12"),
        configLoanBalance
      );
    };

    const elControls = document.querySelector(".controls");
    elControls.addEventListener("click", (event) => {
      let btn = event.target.closest("button");
      if (!btn) return;
      myChartL12.data.datasets[0].data = currentDataChart("cashFlow");
      myChartL12.data.datasets[1].data = currentDataChart("appreciation");
      myChartL12.data.datasets[2].data = currentDataChart("debtPaydown");
      myChartL12.update();
    });

    const elListPoints = document.querySelector(".list-points");

    //TODO
    const elBtnControls = document.querySelectorAll(".chart-data-btn");
    const clearActiveClass = (arr) => {
      for (let i = 0; i < arr.length; i++) {
        arr[i].classList.remove("active");
      }
    };
    elBtnControls[0].addEventListener("click", () => {
      showAppreciationData();
      clearActiveClass(elBtnControls);
      elBtnControls[0].classList.add("active");
    });
    elBtnControls[1].addEventListener("click", () => {
      showCashFlowData();
      clearActiveClass(elBtnControls);
      elBtnControls[1].classList.add("active");
    });
    elBtnControls[2].addEventListener("click", () => {
      showLoanBalance();
      clearActiveClass(elBtnControls);
      elBtnControls[2].classList.add("active");
    });
    // end

    const reduceValue = (fn) => {
      elAccumulatedTitle.innerHTML = parsValue(fn(appreciation));
      elCashFlowTitle.innerHTML = parsValue(fn(cashFlow));
      elProjectedEquityTitle.innerHTML = parsValue(
        fn(appreciation) - fn(cashFlow)
      );
    };

    const setCurrentSumControls = (year) => {
      const sum = (arr) =>
        arr
          .slice(0, year + 1)
          .reduce(
            (previousValue, currentValue) => previousValue + currentValue
          );
      reduceValue(sum);
    };
    const setDefaultSumControls = () => {
      const sum = (arr) =>
        arr.reduce(
          (previousValue, currentValue) => previousValue + currentValue
        );
      reduceValue(sum);
    };

    const createCurrentPointsTitles = (points) => {
      elListPoints.innerHTML = null;
      elListPoints.style.display = "flex";
      elSubTitle.style.display = "none";
      const createPointList = () => {
        return points
          .filter((point) => point !== undefined && typeof point === "number")
          .map((point) => `<li>$ ${point.toFixed(3)}</li>`)
          .join("");
      };
      elListPoints.insertAdjacentHTML("afterbegin", createPointList());
    };
    const showPointsLines = (year, chart) => {
      if (myChartL12.config.type === "line") {
        let currentPoints = [];
        for (let i = 0; i < 3; i++) {
          currentPoints.push(myChartL12.data.datasets[i]?.data[year]);
        }
        createCurrentPointsTitles(currentPoints);
      }
      clearActiveClass(elLegendLabel);
      elLegendLabel[year].classList.add("active");
    };

    const legendCreator = () => {
      let domElements = "";
      for (let i = 1; i <= COUNT_YEARS; i++) {
        domElements += `<div class="legend__label" data-year-value="${
          i - 1
        }">${i}</div>`;
      }
      return domElements;
    };

    const legend = document.querySelector(".legend");
    legend.insertAdjacentHTML("afterbegin", legendCreator());
    const elLegendLabel = document.querySelectorAll(".legend__label");

    const elLegend = document.querySelector(".legend");
    elLegend.addEventListener("click", (e) => {
      if (!e.target.classList.contains("legend__label")) return;
      const year = e.target.dataset.yearValue;
      setCurrentSumControls(Number(year));
      setLineChartPoints(Number(year));
      showPointsLines(Number(year));
    });
    const elLegendLabelArray = document.querySelectorAll(".legend__label");
    elLegendLabelArray.forEach((item) => {
      item.addEventListener("mouseenter", (e) => {
        if (!e.target.classList.contains("legend__label")) return;
        const year = e.target.dataset.yearValue;
        setCurrentSumControls(Number(year));
        setLineChartPoints(Number(year));
        showPointsLines(Number(year));
      });
    });

    const setLineChartPoints = (year) => {
      if (myChartL12.config.type === "line") {
        const points = Array(COUNT_YEARS).fill(false);
        let pointRadius = 5;
        points.splice(year, 1, pointRadius);
        myChartL12.data.datasets[0].pointRadius = points;
        myChartL12.data.datasets[1].pointRadius = points;
        myChartL12.data.datasets[2].pointRadius = points;
        myChartL12.update();
      }
    };

    //TODO working when we deleting update() for setDefaultValueInHtml()
    const clearLineChartPoints = () => {
      if (myChartL12.config.type === "line") {
        myChartL12.data.datasets[0].pointRadius = 0;
        myChartL12.data.datasets[1].pointRadius = 0;
        myChartL12.data.datasets[2].pointRadius = 0;
        myChartL12.update();
      }
    };

    const setDefaultValueInHtml = () => {
      elSubTitle.style.display = "block";
      elListPoints.style.display = "none";
      clearLineChartPoints();
      setDefaultSumControls();
      clearActiveClass(elLegendLabel);
      if (myChartL12.config.type === "bar") {
        myChartL12.config.data.datasets[0].backgroundColor =
          "rgba(127, 219, 179, 1)";
      }
      myChartL12.update();
    };

    setDefaultSumControls();
    Chart.defaults.animation.duration = 0;
  }
</script> -->
